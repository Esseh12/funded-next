"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[635],{47239:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});let a=n(57437),o=n(2265);t.default=function(e){let{html:t,height:n=null,width:s=null,children:r,dataNtpc:i=""}=e;return(0,o.useEffect)(()=>{i&&performance.mark("mark_feature_usage",{detail:{feature:"next-third-parties-".concat(i)}})},[i]),(0,a.jsxs)(a.Fragment,{children:[r,t?(0,a.jsx)("div",{style:{height:null!=n?"".concat(n,"px"):"auto",width:null!=s?"".concat(s,"px"):"auto"},"data-ntpc":i,dangerouslySetInnerHTML:{__html:t}}):null]})}},14888:function(e,t,n){var a;let o;Object.defineProperty(t,"__esModule",{value:!0}),t.sendGAEvent=t.GoogleAnalytics=void 0;let s=n(57437),r=n(2265),i=(a=n(48667))&&a.__esModule?a:{default:a};t.GoogleAnalytics=function(e){let{gaId:t,dataLayerName:n="dataLayer"}=e;return void 0===o&&(o=n),(0,r.useEffect)(()=>{performance.mark("mark_feature_usage",{detail:{feature:"next-third-parties-ga"}})},[]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.default,{id:"_next-ga-init",dangerouslySetInnerHTML:{__html:"\n          window['".concat(n,"'] = window['").concat(n,"'] || [];\n          function gtag(){window['").concat(n,"'].push(arguments);}\n          gtag('js', new Date());\n\n          gtag('config', '").concat(t,"');")}}),(0,s.jsx)(i.default,{id:"_next-ga",src:"https://www.googletagmanager.com/gtag/js?id=".concat(t)})]})},t.sendGAEvent=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];void 0!==o&&window[o]&&window[o].push(arguments)}},81992:function(e,t,n){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});let o=n(57437),s=n(4855),r=a(n(47239));t.default=function(e){let{apiKey:t,...n}=e,a={...n,key:t},{html:i}=(0,s.GoogleMapsEmbed)(a);return(0,o.jsx)(r.default,{height:a.height||null,width:a.width||null,html:i,dataNtpc:"GoogleMapsEmbed"})}},98087:function(e,t,n){var a;Object.defineProperty(t,"__esModule",{value:!0}),t.sendGTMEvent=t.GoogleTagManager=void 0;let o=n(57437),s=n(2265),r=(a=n(48667))&&a.__esModule?a:{default:a},i="dataLayer";t.GoogleTagManager=function(e){let{gtmId:t,dataLayerName:n="dataLayer",auth:a,preview:l,dataLayer:u}=e;i=n;let c="dataLayer"!==n?"&l=".concat(n):"";return(0,s.useEffect)(()=>{performance.mark("mark_feature_usage",{detail:{feature:"next-third-parties-gtm"}})},[]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.default,{id:"_next-gtm-init",dangerouslySetInnerHTML:{__html:"\n      (function(w,l){\n        w[l]=w[l]||[];\n        w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});\n        ".concat(u?"w[l].push(".concat(JSON.stringify(u),")"):"","\n      })(window,'").concat(n,"');")}}),(0,o.jsx)(r.default,{id:"_next-gtm","data-ntpc":"GTM",src:"https://www.googletagmanager.com/gtm.js?id=".concat(t).concat(c).concat(a?"&gtm_auth=".concat(a):"").concat(l?"&gtm_preview=".concat(l,"&gtm_cookies_win=x"):"")})]})},t.sendGTMEvent=(e,t)=>{let n=t||i;window[n]=window[n]||[],window[n].push(e)}},13786:function(e,t,n){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.sendGAEvent=t.GoogleAnalytics=t.sendGTMEvent=t.GoogleTagManager=t.YouTubeEmbed=t.GoogleMapsEmbed=void 0;var o=n(81992);Object.defineProperty(t,"GoogleMapsEmbed",{enumerable:!0,get:function(){return a(o).default}});var s=n(60538);Object.defineProperty(t,"YouTubeEmbed",{enumerable:!0,get:function(){return a(s).default}});var r=n(98087);Object.defineProperty(t,"GoogleTagManager",{enumerable:!0,get:function(){return r.GoogleTagManager}}),Object.defineProperty(t,"sendGTMEvent",{enumerable:!0,get:function(){return r.sendGTMEvent}});var i=n(14888);Object.defineProperty(t,"GoogleAnalytics",{enumerable:!0,get:function(){return i.GoogleAnalytics}}),Object.defineProperty(t,"sendGAEvent",{enumerable:!0,get:function(){return i.sendGAEvent}})},60538:function(e,t,n){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});let o=n(57437),s=a(n(48667)),r=n(4855),i=a(n(47239)),l={server:"beforeInteractive",client:"afterInteractive",idle:"lazyOnload",worker:"worker"};t.default=function(e){let{html:t,scripts:n,stylesheets:a}=(0,r.YouTubeEmbed)(e);return(0,o.jsx)(i.default,{height:e.height||null,width:e.width||null,html:t,dataNtpc:"YouTubeEmbed",children:null==n?void 0:n.map(e=>(0,o.jsx)(s.default,{src:e.url,strategy:l[e.strategy],stylesheets:a},e.url))})}},85629:function(e,t,n){var a=n(92100);n.o(a,"useCurrentLocale")&&n.d(t,{useCurrentLocale:function(){return a.useCurrentLocale}})},92100:function(e,t,n){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.useCurrentLocale=void 0;let o=a(n(41112));t.useCurrentLocale=o.default},41112:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});let a=n(99376),o=(e,t)=>{let n=t.split("; ");for(let t=0;t<n.length;t++){let a=n[t].split("=");if(a[0]===e)return a[1]}return null};t.default=(e,t)=>{let{basePath:n="",locales:s}=e;if(t||"undefined"==typeof window||(t=document.cookie),t){let n=o(e.localeCookie||"NEXT_LOCALE",t);if(n&&s.includes(n))return n}if(e.noPrefix)return e.defaultLocale;let r=(0,a.usePathname)();return s.find(e=>{let t=n.replace(/\/$/,"");return"undefined"==typeof window&&(t=""),r==="".concat(t,"/").concat(e)||(null==r?void 0:r.startsWith("".concat(t,"/").concat(e,"/")))})||(e.prefixDefault?void 0:e.defaultLocale)}},48667:function(e,t,n){n.r(t),n.d(t,{default:function(){return o.a}});var a=n(88003),o=n.n(a),s={};for(var r in a)"default"!==r&&(s[r]=(function(e){return a[e]}).bind(0,r));n.d(t,s)},81523:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return o}});let a=n(18993);function o(e){let{reason:t,children:n}=e;if("undefined"==typeof window)throw new a.BailoutToCSRError(t);return n}},70049:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadCss",{enumerable:!0,get:function(){return s}});let a=n(57437),o=n(20544);function s(e){let{moduleIds:t}=e;if("undefined"!=typeof window)return null;let n=(0,o.getExpectedRequestStore)("next/dynamic css"),s=[];if(n.reactLoadableManifest&&t){let e=n.reactLoadableManifest;for(let n of t){if(!e[n])continue;let t=e[n].files.filter(e=>e.endsWith(".css"));s.push(...t)}}return 0===s.length?null:(0,a.jsx)(a.Fragment,{children:s.map(e=>(0,a.jsx)("link",{precedence:"dynamic",rel:"stylesheet",href:n.assetPrefix+"/_next/"+encodeURI(e),as:"style"},e))})}},4855:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.YouTubeEmbed=t.GoogleMapsEmbed=t.GoogleAnalytics=void 0;var a=n(36014);Object.defineProperty(t,"GoogleAnalytics",{enumerable:!0,get:function(){return a.GoogleAnalytics}});var o=n(16630);Object.defineProperty(t,"GoogleMapsEmbed",{enumerable:!0,get:function(){return o.GoogleMapsEmbed}});var s=n(98712);Object.defineProperty(t,"YouTubeEmbed",{enumerable:!0,get:function(){return s.YouTubeEmbed}})},36014:function(e,t,n){var a=this&&this.__rest||function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&0>t.indexOf(a)&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var o=0,a=Object.getOwnPropertySymbols(e);o<a.length;o++)0>t.indexOf(a[o])&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(n[a[o]]=e[a[o]]);return n},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GoogleAnalytics=void 0;let s=o(n(46893)),r=n(11076);t.GoogleAnalytics=e=>{var t=a(e,[]);return(0,r.formatData)(s.default,t)}},16630:function(e,t,n){var a=this&&this.__rest||function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&0>t.indexOf(a)&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var o=0,a=Object.getOwnPropertySymbols(e);o<a.length;o++)0>t.indexOf(a[o])&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(n[a[o]]=e[a[o]]);return n},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GoogleMapsEmbed=void 0;let s=o(n(46362)),r=n(11076);t.GoogleMapsEmbed=e=>{var t=a(e,[]);return(0,r.formatData)(s.default,t)}},98712:function(e,t,n){var a=this&&this.__rest||function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&0>t.indexOf(a)&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var o=0,a=Object.getOwnPropertySymbols(e);o<a.length;o++)0>t.indexOf(a[o])&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(n[a[o]]=e[a[o]]);return n},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.YouTubeEmbed=void 0;let s=o(n(95825)),r=n(11076);t.YouTubeEmbed=e=>{var t=a(e,[]);return(0,r.formatData)(s.default,t)}},11076:function(e,t){function n(e,t,n=!1){return t?Object.keys(e).filter(e=>n?!t.includes(e):t.includes(e)).reduce((t,n)=>(t[n]=e[n],t),{}):{}}function a(e,t,n,a){let o=a&&Object.keys(a).length>0?new URL(Object.values(a)[0],e):new URL(e);return t&&n&&t.forEach(e=>{n[e]&&o.searchParams.set(e,n[e])}),o.toString()}function o(e,t,n,o,s){var r;if(!t)return`<${e}></${e}>`;let i=(null===(r=t.src)||void 0===r?void 0:r.url)?Object.assign(Object.assign({},t),{src:a(t.src.url,t.src.params,o,s)}):t,l=Object.keys(Object.assign(Object.assign({},i),n)).reduce((e,t)=>{let a=null==n?void 0:n[t],o=i[t],s=null!=a?a:o,r=!0===s?t:`${t}="${s}"`;return s?e+` ${r}`:e},"");return`<${e}${l}></${e}>`}Object.defineProperty(t,"__esModule",{value:!0}),t.formatData=t.createHtml=t.formatUrl=void 0,t.formatUrl=a,t.createHtml=o,t.formatData=function(e,t){var s,r,i,l,u;let c=n(t,null===(s=e.scripts)||void 0===s?void 0:s.reduce((e,t)=>[...e,...Array.isArray(t.params)?t.params:[]],[])),d=n(t,null===(i=null===(r=e.html)||void 0===r?void 0:r.attributes.src)||void 0===i?void 0:i.params),h=n(t,[null===(u=null===(l=e.html)||void 0===l?void 0:l.attributes.src)||void 0===u?void 0:u.slugParam]),p=n(t,[...Object.keys(c),...Object.keys(d),...Object.keys(h)],!0);return Object.assign(Object.assign({},e),{html:e.html?o(e.html.element,e.html.attributes,p,d,h):null,scripts:e.scripts?e.scripts.map(e=>Object.assign(Object.assign({},e),{url:a(e.url,e.params,c)})):null})}},49688:function(e,t,n){n.d(t,{s:function(){return E}});var a=n(2265),o=n(53819);function s(){return(s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)({}).hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(null,arguments)}let r=new Uint8Array(0);class i{static getFullOptions(e){return s({clientTools:{},onConnect:()=>{},onDebug:()=>{},onDisconnect:()=>{},onError:()=>{},onMessage:()=>{},onAudio:()=>{},onModeChange:()=>{},onStatusChange:()=>{},onCanSendFeedbackChange:()=>{}},e)}constructor(e,t){var n=this;this.options=void 0,this.connection=void 0,this.lastInterruptTimestamp=0,this.mode="listening",this.status="connecting",this.volume=1,this.currentEventId=1,this.lastFeedbackEventId=1,this.canSendFeedback=!1,this.endSessionWithDetails=async function(e){"connected"!==n.status&&"connecting"!==n.status||(n.updateStatus("disconnecting"),await n.handleEndSession(),n.updateStatus("disconnected"),n.options.onDisconnect(e))},this.onMessage=async function(e){switch(e.type){case"interruption":return void n.handleInterruption(e);case"agent_response":return void n.handleAgentResponse(e);case"user_transcript":return void n.handleUserTranscript(e);case"internal_tentative_agent_response":return void n.handleTentativeAgentResponse(e);case"client_tool_call":return void await n.handleClientToolCall(e);case"audio":return void n.handleAudio(e);case"ping":return void n.connection.sendMessage({type:"pong",event_id:e.ping_event.event_id});default:return void n.options.onDebug(e)}},this.setVolume=({volume:e})=>{this.volume=e},this.options=e,this.connection=t,this.options.onConnect({conversationId:t.conversationId}),this.connection.onMessage(this.onMessage),this.connection.onDisconnect(this.endSessionWithDetails),this.updateStatus("connected")}endSession(){return this.endSessionWithDetails({reason:"user"})}async handleEndSession(){this.connection.close()}updateMode(e){e!==this.mode&&(this.mode=e,this.options.onModeChange({mode:e}))}updateStatus(e){e!==this.status&&(this.status=e,this.options.onStatusChange({status:e}))}updateCanSendFeedback(){let e=this.currentEventId!==this.lastFeedbackEventId;this.canSendFeedback!==e&&(this.canSendFeedback=e,this.options.onCanSendFeedbackChange({canSendFeedback:e}))}handleInterruption(e){e.interruption_event&&(this.lastInterruptTimestamp=e.interruption_event.event_id)}handleAgentResponse(e){this.options.onMessage({source:"ai",message:e.agent_response_event.agent_response})}handleUserTranscript(e){this.options.onMessage({source:"user",message:e.user_transcription_event.user_transcript})}handleTentativeAgentResponse(e){this.options.onDebug({type:"tentative_agent_response",response:e.tentative_agent_response_internal_event.tentative_agent_response})}async handleClientToolCall(e){if(Object.prototype.hasOwnProperty.call(this.options.clientTools,e.client_tool_call.tool_name))try{var t;let n=null!=(t=await this.options.clientTools[e.client_tool_call.tool_name](e.client_tool_call.parameters))?t:"Client tool execution successful.",a="object"==typeof n?JSON.stringify(n):String(n);this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:a,is_error:!1})}catch(t){this.onError(`Client tool execution failed with following error: ${null==t?void 0:t.message}`,{clientToolName:e.client_tool_call.tool_name}),this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:`Client tool execution failed: ${null==t?void 0:t.message}`,is_error:!0})}else{if(this.options.onUnhandledClientToolCall)return void this.options.onUnhandledClientToolCall(e.client_tool_call);this.onError(`Client tool with name ${e.client_tool_call.tool_name} is not defined on client`,{clientToolName:e.client_tool_call.tool_name}),this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:`Client tool with name ${e.client_tool_call.tool_name} is not defined on client`,is_error:!0})}}handleAudio(e){}onError(e,t){console.error(e,t),this.options.onError(e,t)}getId(){return this.connection.conversationId}isOpen(){return"connected"===this.status}setMicMuted(e){}getInputByteFrequencyData(){return r}getOutputByteFrequencyData(){return r}getInputVolume(){return 0}getOutputVolume(){return 0}sendFeedback(e){this.canSendFeedback?(this.connection.sendMessage({type:"feedback",score:e?"like":"dislike",event_id:this.currentEventId}),this.lastFeedbackEventId=this.currentEventId,this.updateCanSendFeedback()):console.warn(0===this.lastFeedbackEventId?"Cannot send feedback: the conversation has not started yet.":"Cannot send feedback: feedback has already been sent for the current response.")}sendContextualUpdate(e){this.connection.sendMessage({type:"contextual_update",text:e})}sendUserMessage(e){this.connection.sendMessage({type:"user_message",text:e})}sendUserActivity(){this.connection.sendMessage({type:"user_activity"})}sendMCPToolApprovalResult(e,t){this.connection.sendMessage({type:"mcp_tool_approval_result",tool_call_id:e,is_approved:t})}}class l{constructor(e={}){this.queue=[],this.disconnectionDetails=null,this.onDisconnectCallback=null,this.onMessageCallback=null,this.onDebug=void 0,this.onDebug=e.onDebug}debug(e){this.onDebug&&this.onDebug(e)}onMessage(e){this.onMessageCallback=e;let t=this.queue;this.queue=[],t.length>0&&queueMicrotask(()=>{t.forEach(e)})}onDisconnect(e){this.onDisconnectCallback=e;let t=this.disconnectionDetails;t&&queueMicrotask(()=>{e(t)})}disconnect(e){var t;this.disconnectionDetails||(this.disconnectionDetails=e,null==(t=this.onDisconnectCallback)||t.call(this,e))}handleMessage(e){this.onMessageCallback?this.onMessageCallback(e):this.queue.push(e)}}function u(e){let[t,n]=e.split("_");if(!["pcm","ulaw"].includes(t))throw Error(`Invalid format: ${e}`);let a=Number.parseInt(n);if(Number.isNaN(a))throw Error(`Invalid sample rate: ${n}`);return{format:t,sampleRate:a}}let c="conversation_initiation_client_data";function d(e){var t,n,a,o,s;let r={type:c};return e.overrides&&(r.conversation_config_override={agent:{prompt:null==(t=e.overrides.agent)?void 0:t.prompt,first_message:null==(n=e.overrides.agent)?void 0:n.firstMessage,language:null==(a=e.overrides.agent)?void 0:a.language},tts:{voice_id:null==(o=e.overrides.tts)?void 0:o.voiceId},conversation:{text_only:null==(s=e.overrides.conversation)?void 0:s.textOnly}}),e.customLlmExtraBody&&(r.custom_llm_extra_body=e.customLlmExtraBody),e.dynamicVariables&&(r.dynamic_variables=e.dynamicVariables),r}class h extends l{constructor(e,t,n,a){super(),this.socket=void 0,this.conversationId=void 0,this.inputFormat=void 0,this.outputFormat=void 0,this.socket=e,this.conversationId=t,this.inputFormat=n,this.outputFormat=a,this.socket.addEventListener("error",e=>{setTimeout(()=>this.disconnect({reason:"error",message:"The connection was closed due to a socket error.",context:e}),0)}),this.socket.addEventListener("close",e=>{this.disconnect(1e3===e.code?{reason:"agent",context:e}:{reason:"error",message:e.reason||"The connection was closed by the server.",context:e})}),this.socket.addEventListener("message",e=>{try{let t=JSON.parse(e.data);if(!t.type)return;this.handleMessage(t)}catch(e){}})}static async create(e){var t,n;let a=null;try{let n=null!=(t=e.origin)?t:"wss://api.elevenlabs.io",o=e.signedUrl?e.signedUrl:n+"/v1/convai/conversation?agent_id="+e.agentId,s=["convai"];e.authorization&&s.push(`bearer.${e.authorization}`),a=new WebSocket(o,s);let{conversation_id:r,agent_output_audio_format:i,user_input_audio_format:l}=await new Promise((t,n)=>{a.addEventListener("open",()=>{var t;let n=d(e);null==(t=a)||t.send(JSON.stringify(n))},{once:!0}),a.addEventListener("error",e=>{setTimeout(()=>n(e),0)}),a.addEventListener("close",n),a.addEventListener("message",e=>{let n=JSON.parse(e.data);n.type&&("conversation_initiation_metadata"===n.type?t(n.conversation_initiation_metadata_event):console.warn("First received message is not conversation metadata."))},{once:!0})}),c=u(null!=l?l:"pcm_16000"),p=u(i);return new h(a,r,c,p)}catch(e){throw null==(n=a)||n.close(),e}}close(){this.socket.close()}sendMessage(e){this.socket.send(JSON.stringify(e))}}class p extends l{constructor(e,t,n,a,o={}){super(o),this.conversationId=void 0,this.inputFormat=void 0,this.outputFormat=void 0,this.room=void 0,this.isConnected=!1,this.room=e,this.conversationId=t,this.inputFormat=n,this.outputFormat=a,this.setupRoomEventListeners()}static async create(e){let t;if("conversationToken"in e&&e.conversationToken)t=e.conversationToken;else{if(!("agentId"in e)||!e.agentId)throw Error("Either conversationToken or agentId is required for WebRTC connection");try{let n=await fetch(`https://api.elevenlabs.io/v1/convai/conversation/token?agent_id=${e.agentId}`);if(!n.ok)throw Error(`ElevenLabs API returned ${n.status} ${n.statusText}`);if(!(t=(await n.json()).token))throw Error("No conversation token received from API")}catch(n){let t=n instanceof Error?n.message:String(n);throw n instanceof Error&&n.message.includes("401")&&(t="Your agent has authentication enabled, but no signed URL or conversation token was provided."),Error(`Failed to fetch conversation token for agent ${e.agentId}: ${t}`)}}let n=new o.du;try{let a=`webrtc-${Date.now()}`,s=u("pcm_48000"),r=u("pcm_48000"),i=new p(n,a,s,r,e),l=e.livekitUrl||"wss://livekit.rtc.elevenlabs.io";await n.connect(l,t),await new Promise(e=>{if(i.isConnected)e();else{let t=()=>{n.off(o.TQ.Connected,t),e()};n.on(o.TQ.Connected,t)}}),n.name&&(i.conversationId=n.name),await n.localParticipant.setMicrophoneEnabled(!0);let h=d(e);return i.debug({type:c,message:h}),await i.sendMessage(h),i}catch(e){throw await n.disconnect(),e}}setupRoomEventListeners(){var e=this;this.room.on(o.TQ.Connected,async function(){e.isConnected=!0,console.info("WebRTC room connected")}),this.room.on(o.TQ.Disconnected,e=>{this.isConnected=!1,this.disconnect({reason:"agent",context:new CloseEvent("close",{reason:null==e?void 0:e.toString()})})}),this.room.on(o.TQ.ConnectionStateChanged,e=>{e===o.em.Disconnected&&(this.isConnected=!1,this.disconnect({reason:"error",message:`LiveKit connection state changed to ${e}`,context:new Event("connection_state_changed")}))}),this.room.on(o.TQ.DataReceived,(e,t)=>{try{let t=JSON.parse((new TextDecoder).decode(e));if("audio"===t.type)return;t.type?this.handleMessage(t):console.warn("Invalid socket event received:",t)}catch(t){console.warn("Failed to parse incoming data message:",t),console.warn("Raw payload:",(new TextDecoder).decode(e))}}),this.room.on(o.TQ.TrackSubscribed,async function(e,t,n){if(e.kind===o.fQ.Kind.Audio&&n.identity.includes("agent")){let t=e.attach();t.autoplay=!0,t.controls=!1,t.style.display="none",document.body.appendChild(t)}})}close(){this.isConnected&&this.room.disconnect()}async sendMessage(e){if(this.isConnected&&this.room.localParticipant){if(!("user_audio_chunk"in e))try{let t=(new TextEncoder).encode(JSON.stringify(e));await this.room.localParticipant.publishData(t,{reliable:!0})}catch(t){this.debug({type:"send_message_error",message:{message:e,error:t}}),console.error("Failed to send message via WebRTC:",t)}}else console.warn("Cannot send message: room not connected or no local participant")}getRoom(){return this.room}}async function f(e){let t=e.connectionType?e.connectionType:"conversationToken"in e&&e.conversationToken?"webrtc":"websocket";switch(t){case"websocket":return h.create(e);case"webrtc":return p.create(e);default:throw Error(`Unknown connection type: ${t}`)}}function g(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}async function m(e={default:0,android:3e3}){var t,n;let a=e.default;/android/i.test(navigator.userAgent)?a=null!=(t=e.android)?t:a:g()&&(a=null!=(n=e.ios)?n:a),a>0&&await new Promise(e=>setTimeout(e,a))}class v extends i{static async startSession(e){let t=i.getFullOptions(e);t.onStatusChange({status:"connecting"}),t.onCanSendFeedbackChange({canSendFeedback:!1});let n=null;try{return await m(t.connectionDelay),n=await f(e),new v(t,n)}catch(e){var a;throw t.onStatusChange({status:"disconnected"}),null==(a=n)||a.close(),e}}}let y=new Map;function b(e,t){return async n=>{let a=y.get(e);if(a)return n.addModule(a);let o=new Blob([t],{type:"application/javascript"}),s=URL.createObjectURL(o);try{return await n.addModule(s),void y.set(e,s)}catch(e){URL.revokeObjectURL(s)}try{let a=`data:application/javascript;base64,${btoa(t)}`;await n.addModule(a),y.set(e,a)}catch(t){throw Error(`Failed to load the ${e} worklet module. Make sure the browser supports AudioWorklets.`)}}}let w=b("raw-audio-processor",'\nconst BIAS = 0x84;\nconst CLIP = 32635;\nconst encodeTable = [\n  0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,\n  4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,\n  5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,\n  5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,\n  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,\n  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,\n  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,\n  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,\n  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,\n  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,\n  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,\n  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,\n  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,\n  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,\n  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,\n  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7\n];\n\nfunction encodeSample(sample) {\n  let sign;\n  let exponent;\n  let mantissa;\n  let muLawSample;\n  sign = (sample >> 8) & 0x80;\n  if (sign !== 0) sample = -sample;\n  sample = sample + BIAS;\n  if (sample > CLIP) sample = CLIP;\n  exponent = encodeTable[(sample>>7) & 0xFF];\n  mantissa = (sample >> (exponent+3)) & 0x0F;\n  muLawSample = ~(sign | (exponent << 4) | mantissa);\n  \n  return muLawSample;\n}\n\nclass RawAudioProcessor extends AudioWorkletProcessor {\n  constructor() {\n    super();\n              \n    this.port.onmessage = ({ data }) => {\n      switch (data.type) {\n        case "setFormat":\n          this.isMuted = false;\n          this.buffer = []; // Initialize an empty buffer\n          this.bufferSize = data.sampleRate / 4;\n          this.format = data.format;\n\n          if (globalThis.LibSampleRate && sampleRate !== data.sampleRate) {\n            globalThis.LibSampleRate.create(1, sampleRate, data.sampleRate).then(resampler => {\n              this.resampler = resampler;\n            });\n          }\n          break;\n        case "setMuted":\n          this.isMuted = data.isMuted;\n          break;\n      }\n    };\n  }\n  process(inputs) {\n    if (!this.buffer) {\n      return true;\n    }\n    \n    const input = inputs[0]; // Get the first input node\n    if (input.length > 0) {\n      let channelData = input[0]; // Get the first channel\'s data\n\n      // Resample the audio if necessary\n      if (this.resampler) {\n        channelData = this.resampler.full(channelData);\n      }\n\n      // Add channel data to the buffer\n      this.buffer.push(...channelData);\n      // Get max volume \n      let sum = 0.0;\n      for (let i = 0; i < channelData.length; i++) {\n        sum += channelData[i] * channelData[i];\n      }\n      const maxVolume = Math.sqrt(sum / channelData.length);\n      // Check if buffer size has reached or exceeded the threshold\n      if (this.buffer.length >= this.bufferSize) {\n        const float32Array = this.isMuted \n          ? new Float32Array(this.buffer.length)\n          : new Float32Array(this.buffer);\n\n        let encodedArray = this.format === "ulaw"\n          ? new Uint8Array(float32Array.length)\n          : new Int16Array(float32Array.length);\n\n        // Iterate through the Float32Array and convert each sample to PCM16\n        for (let i = 0; i < float32Array.length; i++) {\n          // Clamp the value to the range [-1, 1]\n          let sample = Math.max(-1, Math.min(1, float32Array[i]));\n\n          // Scale the sample to the range [-32768, 32767]\n          let value = sample < 0 ? sample * 32768 : sample * 32767;\n          if (this.format === "ulaw") {\n            value = encodeSample(Math.round(value));\n          }\n\n          encodedArray[i] = value;\n        }\n\n        // Send the buffered data to the main script\n        this.port.postMessage([encodedArray, maxVolume]);\n\n        // Clear the buffer after sending\n        this.buffer = [];\n      }\n    }\n    return true; // Continue processing\n  }\n}\nregisterProcessor("raw-audio-processor", RawAudioProcessor);\n');class _{static async create({sampleRate:e,format:t,preferHeadphonesForIosDevices:n}){let a=null,o=null;try{let s={sampleRate:{ideal:e},echoCancellation:{ideal:!0},noiseSuppression:{ideal:!0}};if(g()&&n){let e=(await window.navigator.mediaDevices.enumerateDevices()).find(e=>"audioinput"===e.kind&&["airpod","headphone","earphone"].find(t=>e.label.toLowerCase().includes(t)));e&&(s.deviceId={ideal:e.deviceId})}let r=navigator.mediaDevices.getSupportedConstraints().sampleRate,i=(a=new window.AudioContext(r?{sampleRate:e}:{})).createAnalyser();r||await a.audioWorklet.addModule("https://cdn.jsdelivr.net/npm/@alexanderolsen/libsamplerate-js@2.1.2/dist/libsamplerate.worklet.js"),await w(a.audioWorklet),o=await navigator.mediaDevices.getUserMedia({audio:s});let l=a.createMediaStreamSource(o),u=new AudioWorkletNode(a,"raw-audio-processor");return u.port.postMessage({type:"setFormat",format:t,sampleRate:e}),l.connect(i),i.connect(u),await a.resume(),new _(a,i,u,o)}catch(e){var s,r;throw null==(s=o)||s.getTracks().forEach(e=>e.stop()),null==(r=a)||r.close(),e}}constructor(e,t,n,a){this.context=void 0,this.analyser=void 0,this.worklet=void 0,this.inputStream=void 0,this.context=e,this.analyser=t,this.worklet=n,this.inputStream=a}async close(){this.inputStream.getTracks().forEach(e=>e.stop()),await this.context.close()}setMuted(e){this.worklet.port.postMessage({type:"setMuted",isMuted:e})}}let k=b("audio-concat-processor",'\nconst decodeTable = [0,132,396,924,1980,4092,8316,16764];\n\nexport function decodeSample(muLawSample) {\n  let sign;\n  let exponent;\n  let mantissa;\n  let sample;\n  muLawSample = ~muLawSample;\n  sign = (muLawSample & 0x80);\n  exponent = (muLawSample >> 4) & 0x07;\n  mantissa = muLawSample & 0x0F;\n  sample = decodeTable[exponent] + (mantissa << (exponent+3));\n  if (sign !== 0) sample = -sample;\n\n  return sample;\n}\n\nclass AudioConcatProcessor extends AudioWorkletProcessor {\n  constructor() {\n    super();\n    this.buffers = []; // Initialize an empty buffer\n    this.cursor = 0;\n    this.currentBuffer = null;\n    this.wasInterrupted = false;\n    this.finished = false;\n    \n    this.port.onmessage = ({ data }) => {\n      switch (data.type) {\n        case "setFormat":\n          this.format = data.format;\n          break;\n        case "buffer":\n          this.wasInterrupted = false;\n          this.buffers.push(\n            this.format === "ulaw"\n              ? new Uint8Array(data.buffer)\n              : new Int16Array(data.buffer)\n          );\n          break;\n        case "interrupt":\n          this.wasInterrupted = true;\n          break;\n        case "clearInterrupted":\n          if (this.wasInterrupted) {\n            this.wasInterrupted = false;\n            this.buffers = [];\n            this.currentBuffer = null;\n          }\n      }\n    };\n  }\n  process(_, outputs) {\n    let finished = false;\n    const output = outputs[0][0];\n    for (let i = 0; i < output.length; i++) {\n      if (!this.currentBuffer) {\n        if (this.buffers.length === 0) {\n          finished = true;\n          break;\n        }\n        this.currentBuffer = this.buffers.shift();\n        this.cursor = 0;\n      }\n\n      let value = this.currentBuffer[this.cursor];\n      if (this.format === "ulaw") {\n        value = decodeSample(value);\n      }\n      output[i] = value / 32768;\n      this.cursor++;\n\n      if (this.cursor >= this.currentBuffer.length) {\n        this.currentBuffer = null;\n      }\n    }\n\n    if (this.finished !== finished) {\n      this.finished = finished;\n      this.port.postMessage({ type: "process", finished });\n    }\n\n    return true; // Continue processing\n  }\n}\n\nregisterProcessor("audio-concat-processor", AudioConcatProcessor);\n');class M{static async create({sampleRate:e,format:t}){let n=null;try{let a=(n=new AudioContext({sampleRate:e})).createAnalyser(),o=n.createGain();o.connect(a),a.connect(n.destination),await k(n.audioWorklet);let s=new AudioWorkletNode(n,"audio-concat-processor");return s.port.postMessage({type:"setFormat",format:t}),s.connect(o),await n.resume(),new M(n,a,o,s)}catch(e){var a;throw null==(a=n)||a.close(),e}}constructor(e,t,n,a){this.context=void 0,this.analyser=void 0,this.gain=void 0,this.worklet=void 0,this.context=e,this.analyser=t,this.gain=n,this.worklet=a}async close(){await this.context.close()}}class O extends i{static async startSession(e){var t,n,a,o,r,l,u;let c=i.getFullOptions(e);c.onStatusChange({status:"connecting"}),c.onCanSendFeedbackChange({canSendFeedback:!1});let d=null,h=null,p=null,g=null,v=null;if(null==(t=e.useWakeLock)||t)try{v=await navigator.wakeLock.request("screen")}catch(e){}try{return g=await navigator.mediaDevices.getUserMedia({audio:!0}),await m(c.connectionDelay),h=await f(e),[d,p]=await Promise.all([_.create(s({},h.inputFormat,{preferHeadphonesForIosDevices:e.preferHeadphonesForIosDevices})),M.create(h.outputFormat)]),null==(n=g)||n.getTracks().forEach(e=>e.stop()),g=null,new O(c,h,d,p,v)}catch(e){c.onStatusChange({status:"disconnected"}),null==(a=g)||a.getTracks().forEach(e=>e.stop()),null==(o=h)||o.close(),await (null==(r=d)?void 0:r.close()),await (null==(l=p)?void 0:l.close());try{await (null==(u=v)?void 0:u.release()),v=null}catch(e){}throw e}}constructor(e,t,n,a,o){super(e,t),this.input=void 0,this.output=void 0,this.wakeLock=void 0,this.inputFrequencyData=void 0,this.outputFrequencyData=void 0,this.onInputWorkletMessage=e=>{"connected"===this.status&&this.connection.sendMessage({user_audio_chunk:function(e){let t=new Uint8Array(e);return window.btoa(String.fromCharCode(...t))}(e.data[0].buffer)})},this.onOutputWorkletMessage=({data:e})=>{"process"===e.type&&this.updateMode(e.finished?"listening":"speaking")},this.addAudioBase64Chunk=e=>{this.output.gain.gain.value=this.volume,this.output.worklet.port.postMessage({type:"clearInterrupted"}),this.output.worklet.port.postMessage({type:"buffer",buffer:function(e){let t=window.atob(e),n=t.length,a=new Uint8Array(n);for(let e=0;e<n;e++)a[e]=t.charCodeAt(e);return a.buffer}(e)})},this.fadeOutAudio=()=>{this.updateMode("listening"),this.output.worklet.port.postMessage({type:"interrupt"}),this.output.gain.gain.exponentialRampToValueAtTime(1e-4,this.output.context.currentTime+2),setTimeout(()=>{this.output.gain.gain.value=this.volume,this.output.worklet.port.postMessage({type:"clearInterrupted"})},2e3)},this.calculateVolume=e=>{if(0===e.length)return 0;let t=0;for(let n=0;n<e.length;n++)t+=e[n]/255;return(t/=e.length)<0?0:t>1?1:t},this.input=n,this.output=a,this.wakeLock=o,this.input.worklet.port.onmessage=this.onInputWorkletMessage,this.output.worklet.port.onmessage=this.onOutputWorkletMessage}async handleEndSession(){await super.handleEndSession();try{var e;await (null==(e=this.wakeLock)?void 0:e.release()),this.wakeLock=null}catch(e){}await this.input.close(),await this.output.close()}handleInterruption(e){super.handleInterruption(e),this.fadeOutAudio()}handleAudio(e){this.lastInterruptTimestamp<=e.audio_event.event_id&&(this.options.onAudio(e.audio_event.audio_base_64),this.addAudioBase64Chunk(e.audio_event.audio_base_64),this.currentEventId=e.audio_event.event_id,this.updateCanSendFeedback(),this.updateMode("speaking"))}setMicMuted(e){this.input.setMuted(e)}getInputByteFrequencyData(){return null!=this.inputFrequencyData||(this.inputFrequencyData=new Uint8Array(this.input.analyser.frequencyBinCount)),this.input.analyser.getByteFrequencyData(this.inputFrequencyData),this.inputFrequencyData}getOutputByteFrequencyData(){return null!=this.outputFrequencyData||(this.outputFrequencyData=new Uint8Array(this.output.analyser.frequencyBinCount)),this.output.analyser.getByteFrequencyData(this.outputFrequencyData),this.outputFrequencyData}getInputVolume(){return this.calculateVolume(this.getInputByteFrequencyData())}getOutputVolume(){return this.calculateVolume(this.getOutputByteFrequencyData())}}class S extends i{static startSession(e){return e.textOnly?v.startSession(e):O.startSession(e)}}function C(){return(C=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)({}).hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(null,arguments)}let x=["micMuted","volume"];function E(e={}){let{micMuted:t,volume:n}=e,o=function(e,t){if(null==e)return{};var n={};for(var a in e)if(({}).hasOwnProperty.call(e,a)){if(t.includes(a))continue;n[a]=e[a]}return n}(e,x),s=(0,a.useRef)(null),r=(0,a.useRef)(null),[i,l]=(0,a.useState)("disconnected"),[u,c]=(0,a.useState)(!1),[d,h]=(0,a.useState)("listening");return(0,a.useEffect)(()=>{var e;void 0!==t&&(null==s||null==(e=s.current)||e.setMicMuted(t))},[t]),(0,a.useEffect)(()=>{var e;void 0!==n&&(null==s||null==(e=s.current)||e.setVolume({volume:n}))},[n]),(0,a.useEffect)(()=>()=>{var e;null==(e=s.current)||e.endSession()},[]),{startSession:async e=>{var a;if(null!=(a=s.current)&&a.isOpen())return s.current.getId();if(r.current)return(await r.current).getId();try{return r.current=S.startSession(C({},null!=o?o:{},null!=e?e:{},{onModeChange:({mode:e})=>{h(e)},onStatusChange:({status:e})=>{l(e)},onCanSendFeedbackChange:({canSendFeedback:e})=>{c(e)}})),s.current=await r.current,void 0!==t&&s.current.setMicMuted(t),void 0!==n&&s.current.setVolume({volume:n}),s.current.getId()}finally{r.current=null}},endSession:async()=>{let e=s.current;s.current=null,await (null==e?void 0:e.endSession())},setVolume:({volume:e})=>{var t;null==(t=s.current)||t.setVolume({volume:e})},getInputByteFrequencyData:()=>{var e;return null==(e=s.current)?void 0:e.getInputByteFrequencyData()},getOutputByteFrequencyData:()=>{var e;return null==(e=s.current)?void 0:e.getOutputByteFrequencyData()},getInputVolume:()=>{var e,t;return null!=(e=null==(t=s.current)?void 0:t.getInputVolume())?e:0},getOutputVolume:()=>{var e,t;return null!=(e=null==(t=s.current)?void 0:t.getOutputVolume())?e:0},sendFeedback:e=>{var t;null==(t=s.current)||t.sendFeedback(e)},getId:()=>{var e;return null==(e=s.current)?void 0:e.getId()},sendContextualUpdate:e=>{var t;null==(t=s.current)||t.sendContextualUpdate(e)},sendUserMessage:e=>{var t;null==(t=s.current)||t.sendUserMessage(e)},sendUserActivity:()=>{var e;null==(e=s.current)||e.sendUserActivity()},sendMCPToolApprovalResult:(e,t)=>{var n;null==(n=s.current)||n.sendMCPToolApprovalResult(e,t)},status:i,canSendFeedback:u,micMuted:t,isSpeaking:"speaking"===d}}},46893:function(e){e.exports=JSON.parse('{"id":"google-analytics","description":"Install a Google Analytics tag on your website","website":"https://analytics.google.com/analytics/web/","scripts":[{"url":"https://www.googletagmanager.com/gtag/js","params":["id"],"strategy":"worker","location":"head","action":"append"},{"code":"window.dataLayer=window.dataLayer||[];window.gtag=function gtag(){window.dataLayer.push(arguments);};gtag(\'js\',new Date());gtag(\'config\',\'${args.id}\')","strategy":"worker","location":"head","action":"append"}]}')},46362:function(e){e.exports=JSON.parse('{"id":"google-maps-embed","description":"Embed a Google Maps embed on your webpage","website":"https://developers.google.com/maps/documentation/embed/get-started","html":{"element":"iframe","attributes":{"loading":"lazy","src":{"url":"https://www.google.com/maps/embed/v1/place","slugParam":"mode","params":["key","q","center","zoom","maptype","language","region"]},"referrerpolicy":"no-referrer-when-downgrade","frameborder":"0","style":"border:0","allowfullscreen":true,"width":null,"height":null}}}')},95825:function(e){e.exports=JSON.parse('{"id":"youtube-embed","description":"Embed a YouTube embed on your webpage.","website":"https://github.com/paulirish/lite-youtube-embed","html":{"element":"lite-youtube","attributes":{"videoid":null,"playlabel":null}},"stylesheets":["https://cdn.jsdelivr.net/gh/paulirish/lite-youtube-embed@master/src/lite-yt-embed.css"],"scripts":[{"url":"https://cdn.jsdelivr.net/gh/paulirish/lite-youtube-embed@master/src/lite-yt-embed.js","strategy":"idle","location":"head","action":"append"}]}')}}]);